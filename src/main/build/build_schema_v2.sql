-- MySQL Script generated by MySQL Workbench
-- Wed Nov 11 17:14:29 2015
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema dbmysql11
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `dbmysql11` ;

-- -----------------------------------------------------
-- Schema dbmysql11
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `dbmysql11` DEFAULT CHARACTER SET utf8 ;
USE `dbmysql11` ;

-- -----------------------------------------------------
-- Table `dbmysql11`.`UserVotes`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`UserVotes` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`UserVotes` (
  `userId` VARCHAR(16) NOT NULL,
  `placeId` VARCHAR(16) NOT NULL,
  `propId` INT(11) NOT NULL,
  `vote` INT(11) NOT NULL)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`categories`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`categories` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`categories` (
  `Id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `Name` VARCHAR(45) NULL DEFAULT NULL,
  `YagoId` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `Id_UNIQUE` (`Id` ASC),
  UNIQUE INDEX `YagoId_UNIQUE` (`YagoId` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 53
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`places`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`places` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`places` (
  `Name` VARCHAR(200) NULL DEFAULT NULL,
  `Lat` DOUBLE NOT NULL,
  `Lon` DOUBLE NOT NULL,
  `Id` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `YagoId_UNIQUE` (`Id` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`placescategories`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`placescategories` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`placescategories` (
  `PlaceId` VARCHAR(200) NOT NULL,
  `CategoryId` VARCHAR(200) NOT NULL,
  INDEX `IX_CATEGORY_ID` (`CategoryId` ASC),
  INDEX `FK_PLACE_ID_idx` (`PlaceId` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`placesprops`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`placesprops` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`placesprops` (
  `PlaceId` VARCHAR(200) NOT NULL,
  `PropId` INT(10) UNSIGNED NOT NULL,
  `prob` DOUBLE NOT NULL,
  INDEX `FK_PLACE_ID` (`PlaceId` ASC),
  INDEX `FK_PROP_ID` (`PropId` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`properties`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`properties` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`properties` (
  `Id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `Name` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `Id_UNIQUE` (`Id` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 8
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`user_roles`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`user_roles` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`user_roles` (
  `user_id` VARCHAR(40) NOT NULL,
  `role` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`users` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`users` (
  `user_id` VARCHAR(40) NOT NULL,
  `password` VARCHAR(45) NULL DEFAULT NULL,
  `access_token` VARCHAR(500) NULL DEFAULT NULL,
  `enabled` TINYINT(4) NULL DEFAULT '1',
  `userscol` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`user_id`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

USE `dbmysql11` ;

-- -----------------------------------------------------
-- procedure CreateForeignKeys
-- -----------------------------------------------------

USE `dbmysql11`;
DROP procedure IF EXISTS `dbmysql11`.`CreateForeignKeys`;

DELIMITER $$
USE `dbmysql11`$$
CREATE DEFINER=`DbMysql11`@`localhost` PROCEDURE `CreateForeignKeys`()
BEGIN

    ALTER TABLE placesprops
	ADD CONSTRAINT FK_PLACE_ID
	FOREIGN KEY (PlaceId)
	REFERENCES places(Id);

    ALTER TABLE placesprops
	ADD CONSTRAINT FK_PROP_ID
	FOREIGN KEY (PropId)
	REFERENCES properties(Id);

    ALTER TABLE placescategories
	ADD CONSTRAINT FK_CATEGORY_ID_
	FOREIGN KEY (CategoryId)
	REFERENCES categories(YagoId);

    ALTER TABLE placescategories
	ADD CONSTRAINT FK_PLACE_ID_
	FOREIGN KEY (PlaceId)
	REFERENCES places(Id);

END$$

DELIMITER ;

-- -----------------------------------------------------
-- procedure RemoveForeignKeys
-- -----------------------------------------------------

USE `dbmysql11`;
DROP procedure IF EXISTS `dbmysql11`.`RemoveForeignKeys`;

DELIMITER $$
USE `dbmysql11`$$
CREATE DEFINER=`DbMysql11`@`localhost` PROCEDURE `RemoveForeignKeys`()
BEGIN

    ALTER TABLE placesprops
	  DROP FOREIGN KEY FK_PLACE_ID;


    ALTER TABLE placesprops
	  DROP FOREIGN KEY FK_PROP_ID;


    ALTER TABLE placescategories
	  DROP FOREIGN KEY FK_CATEGORY_ID_;

    ALTER TABLE placescategories
	  DROP FOREIGN KEY FK_PLACE_ID_;

END$$

DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;
