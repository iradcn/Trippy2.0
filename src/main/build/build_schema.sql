-- MySQL Script generated by MySQL Workbench
-- 05/27/15 01:07:53
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
-- -----------------------------------------------------
-- Schema dbmysql11
-- -----------------------------------------------------

-- -----------------------------------------------------
-- Schema dbmysql11
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `dbmysql11` DEFAULT CHARACTER SET utf8 ;
USE `dbmysql11` ;

-- -----------------------------------------------------
-- Table `dbmysql11`.`categories`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`categories` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`categories` (
  `Id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `Name` VARCHAR(45) NULL DEFAULT NULL,
  `YagoId` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `Id_UNIQUE` (`Id` ASC),
  UNIQUE INDEX `YagoId_UNIQUE` (`YagoId` ASC))
ENGINE = InnoDB
AUTO_INCREMENT = 36
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`places`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`places` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`places` (
  `Name` VARCHAR(200) NULL DEFAULT NULL,
  `Lat` DOUBLE NOT NULL,
  `Lon` DOUBLE NOT NULL,
  `Id` VARCHAR(200) NOT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `YagoId_UNIQUE` (`Id` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`placescategories`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`placescategories` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`placescategories` (
  `PlaceId` VARCHAR(200) NOT NULL,
  `CategoryId` VARCHAR(200) NOT NULL,
  INDEX `IX_CATEGORY_ID` (`CategoryId` ASC),
  INDEX `FK_PLACE_ID_idx` (`PlaceId` ASC),
  CONSTRAINT `FK_CATEGORY_ID_`
    FOREIGN KEY (`CategoryId`)
    REFERENCES `dbmysql11`.`categories` (`YagoId`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_PLACE_ID_`
    FOREIGN KEY (`PlaceId`)
    REFERENCES `dbmysql11`.`places` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`properties`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`properties` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`properties` (
  `Id` INT(10) UNSIGNED NOT NULL AUTO_INCREMENT,
  `Name` VARCHAR(45) NULL DEFAULT NULL,
  PRIMARY KEY (`Id`),
  UNIQUE INDEX `Id_UNIQUE` (`Id` ASC))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `dbmysql11`.`placesprops`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `dbmysql11`.`placesprops` ;

CREATE TABLE IF NOT EXISTS `dbmysql11`.`placesprops` (
  `PlaceId` VARCHAR(200) NOT NULL,
  `PropId` INT(10) UNSIGNED NOT NULL,
  INDEX `IX_PROP` (`PropId` ASC),
  INDEX `FK_PLACE_ID_idx` (`PlaceId` ASC),
  CONSTRAINT `FK_PLACE_ID`
    FOREIGN KEY (`PlaceId`)
    REFERENCES `dbmysql11`.`places` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `FK_PROP_ID`
    FOREIGN KEY (`PropId`)
    REFERENCES `dbmysql11`.`properties` (`Id`)
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

DELIMITER $$
CREATE DEFINER=`DbMysql11`@`localhost` PROCEDURE `CreateForeignKeys`()
BEGIN

    ALTER TABLE placesprops
	ADD CONSTRAINT FK_PLACE_ID
	FOREIGN KEY (PlaceId)
	REFERENCES places(Id);

    ALTER TABLE placesprops
	ADD CONSTRAINT FK_PROP_ID
	FOREIGN KEY (PropId)
	REFERENCES properties(Id);

    ALTER TABLE placescategories
	ADD CONSTRAINT FK_CATEGORY_ID_
	FOREIGN KEY (CategoryId)
	REFERENCES categories(YagoId);

    ALTER TABLE placescategories
	ADD CONSTRAINT FK_PLACE_ID_
	FOREIGN KEY (PlaceId)
	REFERENCES places(Id);

END$$
DELIMITER ;

DELIMITER $$
CREATE DEFINER=`DbMysql11`@`localhost` PROCEDURE `RemoveForeignKeys`()
BEGIN

    ALTER TABLE placesprops
	  DROP FOREIGN KEY FK_PLACE_ID;


    ALTER TABLE placesprops
	  DROP FOREIGN KEY FK_PROP_ID;


    ALTER TABLE placescategories
	  DROP FOREIGN KEY FK_CATEGORY_ID_;

    ALTER TABLE placescategories
	  DROP FOREIGN KEY FK_PLACE_ID_;

END$$
DELIMITER ;


